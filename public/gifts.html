<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Presentes</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    <style>
        


        #clear-button{
            margin-left: 10px;
        }

        #save-button{
            margin-left: 25%;
        }
        body {
            background: linear-gradient(135deg, #FBFADA, #ADBC9F, #ADBC9F, #FBFADA);
            justify-content: center;         
            flex-direction: column;

        }
        .present-box {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #852222;
            border-radius: 5px;
            display: flex;
            align-content: center;
            align-items: center;
            width: 50%;
            height: 140px;
            background-color: #fff;
            margin-left: 25%;
            }
        .present-box img {
            max-width: 64px;
            margin-right: 20px;
        }
        .checkbox {
            border-radius: 90px;
            justify-content: center;
            flex-direction: column;
           
        
        }
        .checkbox.disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        .selected-by-others {
        color: red; /* Cor vermelha para texto já selecionado */
        font-weight: bold; /* Opcional: torna o texto em negrito */
    }
    .title{
            margin-bottom: 20px;
            padding-top: 20px;
            display: flex;
            align-content: center;
            align-items: center; 
            margin-left: 25%;
            
    }

  @media  (max-width: 600px) {
    .title {
        margin-bottom: 20px;
        padding-top: 20px;
        display: flex;
        margin-left: 5%;
        
        justify-content: left;  /* Corrigido de align-content para justify-content */
        align-items: center;
    }
    .present-box {
        margin-bottom: 20px;
        padding: 10px;
        border: 1px solid #6320dd;
        border-radius: 10px;
        display: flex;
        justify-content: center; /* Corrigido de align-content para justify-content */
        align-items: center;
        width: 90%;
        margin-left:5%;
        height: 50%;
        background-color: #fff;
    }
    body {
        background: linear-gradient(135deg, #FBFADA, #ADBC9F, #ADBC9F, #FBFADA);
        display: flex;
        justify-content: left;
        align-items: center; /* Adicionado para centralizar verticalmente */
        flex-direction: column;
  
    }
    #save-button{
        margin-left: 5%;
        margin-bottom: 5%;
    }
}
  
    </style>
</head>
<body>
    <div class="container">
        <h2 class="title">Selecione os presentes:</h2>

        <!-- Presente 1 -->
        <div class="present-box" id="present1">
            <div class="media-left">
                <figure class="image is-64x64">
                    <img src="https://http2.mlstatic.com/D_NQ_NP_970085-MLA50595311592_072022-O.webp" alt="Imagem Presente 1">
                </figure>
            </div>
            <div class="media-content">
                <div class="content" id="present1-description">
                    <p><strong>Presente 1</strong> <small>Marca A</small></p>
                    <p>Descrição do Presente 1.</p>
                </div>
                <label class="checkbox">
                    <input type="checkbox" name="gifts" value="1" id="presente1">
                    <span>Selecionar este presente</span>
                </label>
            </div>
        </div>

        <!-- Presente 2 -->
        <div class="present-box" id="present2">
            <div class="media-left">
                <figure class="image is-64x64">
                    <img src="https://http2.mlstatic.com/D_NQ_NP_970085-MLA50595311592_072022-O.webp" alt="Imagem Presente 2">
                </figure>
            </div>
            <div class="media-content">
                <div class="content" id="present2-description">
                    <p><strong>Presente 2</strong> <small>Marca B</small></p>
                    <p>Descrição do Presente 2.</p>
                </div>
                <label class="checkbox">
                    <input type="checkbox" name="gifts" value="2" id="presente2">
                    <span>Selecionar este presente</span>
                </label>
            </div>
        </div>

        <!-- Presente 3 -->
        <div class="present-box" id="present3">
            <div class="media-left">
                <figure class="image is-64x64">
                    <img src="https://http2.mlstatic.com/D_NQ_NP_970085-MLA50595311592_072022-O.webp" alt="Imagem Presente 3">
                </figure>
            </div>
            <div class="media-content">
                <div class="content" id="present3-description">
                    <p><strong>Presente 3</strong> <small>Marca C</small></p>
                    <p>Descrição do Presente 3.</p>
                </div>
                <label class="checkbox">
                    <input type="checkbox" name="gifts" value="3" id="presente3">
                    <span>Selecionar este presente</span>
                </label>
            </div>
        </div>

        <!-- Presente 4 -->
        <div class="present-box" id="present4">
            <div class="media-left">
                <figure class="image is-64x64">
                    <img src="https://http2.mlstatic.com/D_NQ_NP_970085-MLA50595311592_072022-O.webp" alt="Imagem Presente 4">
                </figure>
            </div>
            <div class="media-content">
                <div class="content" id="present4-description">
                    <p><strong>Presente 4</strong> <small>Marca D</small></p>
                    <p>Descrição do Presente 4.</p>
                </div>
                <label class="checkbox">
                    <input type="checkbox" name="gifts" value="4" id="presente4">
                    <span>Selecionar este presente</span>
                </label>
            </div>
        </div>

        <!-- Presente 5 -->
        <div class="present-box" id="present5">
            <div class="media-left">
                <figure class="image is-64x64">
                    <img src="https://http2.mlstatic.com/D_NQ_NP_970085-MLA50595311592_072022-O.webp" alt="Imagem Presente 5">
                </figure>
            </div>
            <div class="media-content">
                <div class="content" id="present5-description">
                    <p><strong>Presente 5</strong> <small>Marca E</small></p>
                    <p>Descrição do Presente 5.</p>
                </div>
                <label class="checkbox">
                    <input type="checkbox" name="gifts" value="5" id="presente5">
                    <span>Selecionar este presente</span>
                </label>
            </div>
        </div>

        <!-- Presente 6 -->
        <div class="present-box" id="present6">
            <div class="media-left">
                <figure class="image is-64x64">
                    <img src="https://http2.mlstatic.com/D_NQ_NP_970085-MLA50595311592_072022-O.webp" alt="Imagem Presente 6">
                </figure>
            </div>
            <div class="media-content">
                <div class="content" id="present6-description">
                    <p><strong>Presente 6</strong> <small>Marca F</small></p>
                    <p>Descrição do Presente 6.</p>
                </div>
                <label class="checkbox">
                    <input type="checkbox" name="gifts" value="6" id="presente6">
                    <span>Selecionar este presente</span>
                </label>
            </div>
        </div>

        <!-- Presente 7 -->
        <div class="present-box" id="present7">
            <div class="media-left">
                <figure class="image is-64x64">
                    <img src="https://http2.mlstatic.com/D_NQ_NP_970085-MLA50595311592_072022-O.webp" alt="Imagem Presente 7">
                </figure>
            </div>
            <div class="media-content">
                <div class="content" id="present7-description">
                    <p><strong>Presente 7</strong> <small>Marca G</small></p>
                    <p>Descrição do Presente 7.</p>
                </div>
                <label class="checkbox">
                    <input type="checkbox" name="gifts" value="7" id="presente7">
                    <span>Selecionar este presente</span>
                </label>
            </div>
        </div>

        <!-- Presente 8 -->
        <div class="present-box" id="present8">
            <div class="media-left">
                <figure class="image is-64x64">
                    <img src="https://http2.mlstatic.com/D_NQ_NP_970085-MLA50595311592_072022-O.webp" alt="Imagem Presente 8">
                </figure>
            </div>
            <div class="media-content">
                <div class="content" id="present8-description">
                    <p><strong>Presente 8</strong> <small>Marca H</small></p>
                    <p>Descrição do Presente 8.</p>
                </div>
                <label class="checkbox">
                    <input type="checkbox" name="gifts" value="8" id="presente8">
                    <span>Selecionar este presente</span>
                </label>
            </div>
        </div>

        <!-- Presente 9 -->
        <div class="present-box" id="present9">
            <div class="media-left">
                <figure class="image is-64x64">
                    <img src="https://http2.mlstatic.com/D_NQ_NP_970085-MLA50595311592_072022-O.webp" alt="Imagem Presente 9">
                </figure>
            </div>
            <div class="media-content">
                <div class="content" id="present9-description">
                    <p><strong>Presente 9</strong> <small>Marca I</small></p>
                    <p>Descrição do Presente 9.</p>
                </div>
                <label class="checkbox">
                    <input type="checkbox" name="gifts" value="9" id="presente9">
                    <span>Selecionar este presente</span>
                </label>
            </div>
        </div>

        <!-- Presente 10 -->
        <div class="present-box" id="present10">
            <div class="media-left">
                <figure class="image is-64x64">
                    <img src="https://http2.mlstatic.com/D_NQ_NP_970085-MLA50595311592_072022-O.webp" alt="Imagem Presente 10">
                </figure>
            </div>
            <div class="media-content">
                <div class="content" id="present10-description">
                    <p><strong>Presente 10</strong> <small>Marca J</small></p>
                    <p>Descrição do Presente 10.</p>
                </div>
                <label class="checkbox">
                    <input type="checkbox" name="gifts" value="10" id="presente10">
                    <span>Selecionar este presente</span>
                </label>
            </div>
        </div>

        <button class="button is-primary" onclick="saveSelections()" id="save-button">Salvar</button>
        <button class="button is-light" onclick="clearSelections()"id="clear-button">Limpar</button>
    </div>

    <script>
        async function saveSelections() {
            const username = getUsernameFromUrl();

            const selections = {
                presente1: { selected: document.getElementById('presente1').checked, user: username },
                presente2: { selected: document.getElementById('presente2').checked, user: username },
                presente3: { selected: document.getElementById('presente3').checked, user: username },
                presente4: { selected: document.getElementById('presente4').checked, user: username },
                presente5: { selected: document.getElementById('presente5').checked, user: username },
                presente6: { selected: document.getElementById('presente6').checked, user: username },
                presente7: { selected: document.getElementById('presente7').checked, user: username },
                presente8: { selected: document.getElementById('presente8').checked, user: username },
                presente9: { selected: document.getElementById('presente9').checked, user: username },
                presente10: { selected: document.getElementById('presente10').checked, user: username },
            };

            try {
                const response = await fetch('/get-selections');
                const currentData = await response.json();

                for (const key in selections) {
                    if (!document.getElementById(key).disabled) {
                        currentData[key] = selections[key];
                    }
                }

                const saveResponse = await fetch('/save-selections', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(currentData)
                });

                if (!saveResponse.ok) {
                    throw new Error('Erro ao salvar seleções');
                }

                for (const key in selections) {
                    const checkbox = document.getElementById(key);
                    if (selections[key].selected && !checkbox.disabled) {
                        checkbox.disabled = true;
                        checkbox.nextElementSibling.textContent = `${username} selecionou este presente`;
                    }
                }
            } catch (error) {
                console.error('Erro ao salvar seleções:', error);
            }
        }

        async function clearSelections() {
            const username = getUsernameFromUrl();

            try {
                const response = await fetch('/get-selections');
                const data = await response.json();

                for (const key in data) {
                    if (data[key].user === username) {
                        data[key] = { selected: false, user: null };
                    }
                }

                const saveResponse = await fetch('/save-selections', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (!saveResponse.ok) {
                    throw new Error('Erro ao limpar seleções');
                }

                for (const key in data) {
                    const checkbox = document.getElementById(key);
                    if (data[key].user === null && checkbox.disabled) {
                        checkbox.disabled = false;
                        checkbox.checked = false;
                        checkbox.nextElementSibling.textContent = 'Selecionar este Presente';
                    }
                }
            } catch (error) {
                console.error('Erro ao limpar seleções:', error);
            }
        }


        async function loadSelections() {
            try {
                const response = await fetch('/get-selections');
                const data = await response.json();
                const username = getUsernameFromUrl();

                for (const key in data) {
                    const checkbox = document.getElementById(key);
                    if (data[key].selected && data[key].user !== username) {
                        checkbox.disabled = true;
                        checkbox.checked = true;
                        checkbox.nextElementSibling.textContent = `Presente já selecionado`;
                        checkbox.nextElementSibling.classList.add('selected-by-others');
                    } else if (data[key].selected && data[key].user === username) {
                        checkbox.disabled = true;
                        checkbox.checked = true;
                        checkbox.nextElementSibling.textContent = `Você selecionou este presente`;
                    } else {
                        checkbox.disabled = false;
                        checkbox.checked = false;
                        checkbox.nextElementSibling.textContent = 'Selecionar este presente';
                        checkbox.nextElementSibling.classList.remove('selected-by-others');
                    }
                }
            } catch (error) {
                console.error('Erro ao carregar seleções:', error);
            }
        }

        function getUsernameFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('username') || 'Usuário';
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadSelections();
        });
    </script>
</body>
</html>